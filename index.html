<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pantheon of Nations - Rules</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <h1>Pantheon of Nations</h1>
    <nav>
      <a href="#components">Components</a>
      <a href="#General Information">General Information</a>
      <a href="#phases">Phases</a>
      <a href="#orders">Orders</a>
      <a href="#abilities">Abilities</a>
      <a href="#status">Status Effects</a>
      <a href="#faq">FAQ</a>
    </nav>
  </header>

  <main>
    <section id="components">
       <div class="components-section">
        <h2 class="section-title">Game Components</h2>
        <div class="components-grid" id="componentsGrid">
            <!-- Components will be generated here -->
        </div>
    </div>
    </section>

    <section id="General Information">
      <h2>General Information</h2>
      <p>Pantheon of Nations is a strategic game set in a fantasy world. Players choose one of the nations. Each nation is led by a deity who has taken the physical form of an avatar. In addition to avatars, the battle involves followers – brave mortal warriors ready to give their lives for their deity. Each nation has unique mechanics, marked in the rules with its corresponding color (dark red for Japan, light orange for Vijayanagara, blue for Nomads, turquoise for Aztecs).</p>

      <h3>Game Objective</h3>
      <p>The objective of the game is to be the last surviving avatar on the board. As soon as an avatar's health drops to 0, the controlling player is immediately eliminated from the game, and all their followers are removed from the battlefield. Depending on the game mode, a different number of players participate in the confrontation.</p>

      <h3>Game Modes</h3>
      <ul>
        <li><strong>2 Players – Duel:</strong> Each player fights for themselves, aiming to be the last one on the board.</li>
        <li><strong>3 Players – Skirmish:</strong> Each player fights for themselves, aiming to be the last one on the board.</li>
        <li><strong>4 Players – Team Battle:</strong> Players are divided into 2 teams. The team whose both avatars have perished is declared the loser.</li>
      </ul>

      <h3>Game Terms</h3>
      <ul>
        <li><strong>Avatar:</strong> The physical embodiment of a deity.</li>
        <li><strong>Followers:</strong> Warriors representing various nations.</li>
        <li><strong>Unit:</strong> Both an avatar and a follower.</li>
        <li><strong>Line of Sight:</strong> A straight line between the unit using an ability and the target, not obstructed by other units and not extending beyond the boundaries of the game board.</li>
        <li><strong>Arcing Shot:</strong> A straight line that is not obstructed by other units (archers attack along such a trajectory).</li>
      </ul>
    </section>

    <section id="phases">
      <h2>Phases</h2>
      <p>The following rules describe gameplay for 2 players. All differences for other player counts are described later.</p>
      
      <div class="zero-round-info">
        <h3>Zero Round</h3>
        <p>The <strong>Zero Round</strong> skips the Betting Phase, Planning Phase, and End of Round Phase. Each player, in turn order, performs one action with each unit without placing an order token. Only <em>Movement</em> and <em>Recruit</em> actions are allowed.</p>
      </div>

      <div class="phases-container">
        <div class="phase-card">
          <h3>1. Betting Phase</h3>
          <p>Each player has 5 faith tokens. Then, each player clenches any number of tokens in their fist: this is their bet. Bets are made secretly. When all players have made their bets, their fists are opened. The player who made the highest bet becomes the first player. Other players take turn order according to their bet. In case of a tie, players take places in the opposite order from the previous round. If players made equal bets in the first round, the turn order is determined randomly.</p>
          <p>The player who takes the first spot on the initiative track chooses which of the two blessing cards on the second tier will become active. Then they choose which of the three blessing cards on the third tier will occupy the freed slot on the second tier. The effects of blessing cards work throughout the entire round. They give a significant advantage to the first player and can change the basic rules of the game.</p>
        </div>

        <div class="phase-card">
          <h3>2. Planning Phase</h3>
          <p>In this phase, each player must give exactly one order to one unit. For followers, order tokens are placed on their tiles; for avatars, order tokens are placed on their image on the nation board. Players place one order token in initiative order.</p>
          <p>Order tokens are placed using faith tokens remaining after the Betting Phase. One faith token allows placing one order token. Faith tokens can also be spent to remove Status Effects: one faith token removes one Status Effect token from a friendly unit. If a player exhausts their supply of faith tokens, their Planning Phase ends. Each unit cannot receive more than one order.</p>
          <p>Types of orders:</p>
          <ul>
            <li>Movement</li>
            <li>Recruit</li>
            <li>Attack</li>
            <li>Blood Shield</li>
            <li>Ability</li>
          </ul>
        </div>

        <div class="phase-card">
          <h3>3. Action Phase</h3>
          <p>In turn order, each player reveals and executes one action token until all tokens are resolved. If a player has no more tokens, they skip their turn.</p>
        </div>

        <div class="phase-card">
          <h3>4. End of Round</h3>
          <p>All status effects trigger. Conflicts (e.g. multiple avatar deaths) are resolved based on initiative order.</p>
          <p>Cooldowns move left, active Blessing is discarded, and a new round begins.</p>
        </div>
      </div>
    </section>

    <section id="orders">
      <h2>Order Types</h2>
      <div class="orders-container">
        <details>
          <summary>Movement <img src='img/order-move.png' alt='Movement order'></summary>
          <div class="order-content">
            Moving units from one hex to another. Each unit can move a different number of hexes, but not less than 1. You cannot move through friendly or enemy units.
            Foot followers move 1 hex.
            Mounted followers move up to 2 hexes.
            Avatars move up to 3 hexes.
            The elephant of the Vijayanagara nation is a special unit. Another foot follower's tile can be placed on top of the elephant tile. This can be done either by a foot follower's Movement action or by a Recruit action. The elephant and the follower on it move together, counting as a mounted follower.
          </div>
        </details>

        <details>
          <summary>Recruit <img src='img/order-recruit.png' alt='Recruit order'></summary>
          <div class="order-content">
            The recruit order allows placing new followers on the battlefield. Follower tiles can only be placed on the starting hex and two separately colored adjacent hexes. New follower tiles can only be placed on empty hexes.
          </div>
        </details>

        <details>
          <summary>Attack <img src='img/order-attack.png' alt='Attack order'></summary>
          <div class="order-content">
            The main action by which units deal damage to each other. Each type of unit has its own Attack mechanic:
            <div><strong>Swordsmen:</strong> Deal crushing damage at close range. They deal 4 damage, but only to adjacent hexes.<br><img src='img/hex-swordsmen.png' alt='Swordsmen attack pattern'></div>
            <div><strong>Spearmen:</strong> Deal 2 damage to an adjacent hex and those beyond it. This attack has piercing damage, meaning all units in those hexes (even friendly ones) take damage.<br><img src='img/hex-spearmen.png' alt='Spearmen attack pattern'></div>
            <div><strong>Archers:</strong> Deal damage depending on the target's range. Archers shoot in an arcing trajectory. A target 3 hexes away takes 3 damage, 2 hexes away takes 2 damage, and an adjacent hex takes only 1 damage.<br><img src='img/hex-archer.png' alt='Archer attack pattern'></div>
            <strong>Avatars:</strong> Deal damage only to adjacent hexes depending on the chosen ability cards.<br>
            Imaginary targets can also be targets of an attack. These units are not physically on the field, but you can choose them as a target to avoid dealing damage to a friendly unit or activating Blood Shield.
          </div>
        </details>

        <details>
          <summary>Blood Shield <img src='img/order-shield.png' alt='Blood Shield order'></summary>
          <div class="order-content">
            Allows turning an opponent's Attack against them. If an Attack is dealt to a unit with a Blood Shield token on it, this token is automatically revealed. The attacking unit, instead of dealing damage from its Attack to the enemy, deals that damage to itself.<br>
            <em>Important!</em> Blood Shield only protects against Attacks, but not against Abilities. Blood Shield can only protect against Abilities whose text states to perform an Attack.<br>
            A player who placed a Blood Shield token cannot flip it themselves. If the turn reaches a player who has played all order tokens except Blood Shield, the Blood Shield token is revealed. Then, the unit that had the Blood Shield token takes damage equal to its Attack. Archers take 2 damage from Blood Shield.
          </div>
        </details>

        <details>
          <summary>Ability <img src='img/order-ability.png' alt='Ability order'></summary>
          <div class="order-content">
            There are two types of abilities: active and triggers. Triggers do not require special tokens to activate. They activate at the player's discretion when certain conditions are met, such as performing a recruit action, an enemy entering a designated zone, or a unit's death.<br>
            To play an active ability, an Ability token must be placed on the avatar's image on the nation board. During the action phase, described later, a player has the right to play any available Ability card, meaning one that is not on cooldown. After playing an Ability card, the player places it on a special spot on the board corresponding to the ability's cooldown duration.<br>
            An exception to this rule is the Yamato nation, whose special units can use Abilities. To play a special unit's Ability in the Action Phase, during the setup phase, place the Ability action token on the corresponding follower tile.
          </div>
        </details>
      </div>
    </section>

    <section id="abilities">
      <h2>Abilities</h2>
      <div class="abilities-content">
        <p>There are two types of abilities: active and triggers. Triggers do not require special tokens to activate. They activate at the player's discretion when certain conditions are met, such as performing a recruit action, an enemy entering a designated zone, or a unit's death.</p>
        <p>To play an active ability, an Ability token must be placed on the avatar's image on the nation board. During the action phase, described later, a player has the right to play any available Ability card, meaning one that is not on cooldown. After playing an Ability card, the player places it on a special spot on the board corresponding to the ability's cooldown duration.</p>
        <p>An exception to this rule is the Yamato nation, whose special units can use Abilities. To play a special unit's Ability in the Action Phase, during the setup phase, place the Ability action token on the corresponding follower tile.</p>
        <p>Abilities acting at a distance have three types of trajectories:</p>
        <ul>
          <li><strong>Line of Sight:</strong> This is a straight line that can be obstructed by both friendly and enemy units.</li>
          <li><strong>Arcing Shot:</strong> This is a straight line that is not obstructed by other units.</li>
          <li><strong>Any Unit:</strong> The ability can target any unit within the specified radius, regardless of obstacles.</li>
        </ul>
        <p>Some abilities allow miniatures to cover multiple hexes simultaneously. The ability card shows the area affected. Rotations and mirror reflections of the pattern are allowed, even if part of it is off the board.</p>
        <p><strong>White hexes</strong> = caster position.<br><strong>Light red hexes</strong> = affected area.</p>
        <p><strong>Electricity X:</strong> Deals damage in a chain. First unit takes X, next adjacent takes X-1, etc. Max length X. No unit is hit more than once per cast.</p>
        <p><strong>Other abilities include:</strong></p>
        <ul>
          <li><strong>Multi-Strike:</strong> Perform an Attack X times.</li>
          <li><strong>Piercing Attack:</strong> Attack several hexes in a line.</li>
          <li><strong>Attraction/Repulsion:</strong> Move a unit X hexes toward/away, then deal X damage.</li>
        </ul>
      </div>
    </section>

    <section id="status">
      <h2>Status Effects</h2>
      <ul class="status-list">
        <li><strong>Ice:</strong> Unit cannot act. Remove 1 per round.<br><img src="img/status-ice.png" alt="Ice status effect"></li>
        <li><strong>Fire:</strong> Burns units at end of round.<br><img src="img/status-fire.png" alt="Fire status effect"></li>
        <li><strong>Bleeding:</strong> Triggers on order use.<br><img src="img/status-bleeding.png" alt="Bleeding status effect"></li>
        <li><strong>Blight:</strong> Deals damage per round, decaying.<br><img src="img/status-blight.png" alt="Blight status effect"></li>
      </ul>
    </section>

    <section id="faq">
      <h2>FAQ Highlights</h2>
      <ul class="faq-list">
        <li>Teleport is not movement.</li>
        <li>Blood Shield doesn't block abilities unless they contain Attacks.</li>
        <li>Elephant damage doesn't overflow to rider.</li>
        <li>Nomads' Trigger ignores teleport/blessing swaps.</li>
      </ul>
    </section>
  </main>

   <script>
        // Component data structure - easy to modify
        const componentsData = {
            "Game Boards": {
                type: "multi",
                items: [
                    { name: "2 Players Board", image: "img/board-2p.png" },
                    { name: "3 Players Board", image: "img/board-3p.png" },
                    { name: "4 Players Board", image: "img/board-4p.png" }
                ]
            },
            // "Blessings Board": {
            //     type: "single",
            //     image: "img/blessings-board.png"
            // },
            "Nation Boards": {
                type: "nations",
                items: [
                    { name: "Japan Board", image: "img/nation-japan.png", nation: "japan" },
                    { name: "Vijayanagara Board", image: "img/nation-vijayanagara.png", nation: "vijayanagara" },
                    { name: "Nomads Board", image: "img/nation-nomads.png", nation: "nomads" },
                    { name: "Aztecs Board", image: "img/nation-aztecs.png", nation: "aztecs" }
                ]
            },
            "Avatar Miniatures": {
                type: "nations",
                items: [
                    { name: "Japan Avatar", image: "img/avatar-japan.png", nation: "japan" },
                    { name: "Vijayanagara Avatar", image: "img/avatar-vijayanagara.png", nation: "vijayanagara" },
                    { name: "Nomads Avatar", image: "img/avatar-nomads.png", nation: "nomads" },
                    { name: "Aztecs Avatar", image: "img/avatar-aztecs.png", nation: "aztecs" }
                ]
            },
            // "Follower Tiles": {
            //     type: "nations",
            //     items: [
            //         { name: "Japan Followers", image: "img/followers-japan.png", nation: "japan" },
            //         { name: "Vijayanagara Followers", image: "img/followers-vijayanagara.png", nation: "vijayanagara" },
            //         { name: "Nomads Followers", image: "img/followers-nomads.png", nation: "nomads" },
            //         { name: "Aztecs Followers", image: "img/followers-aztecs.png", nation: "aztecs" }
            //     ]
            // },
            "Ability Cards": {
                type: "nations",
                items: [
                    { name: "Japan Abilities", image: "img/abilities-japan.png", nation: "japan" },
                    { name: "Vijayanagara Abilities", image: "img/abilities-vijayanagara.png", nation: "vijayanagara" },
                    { name: "Nomads Abilities", image: "img/abilities-nomads.png", nation: "nomads" },
                    { name: "Aztecs Abilities", image: "img/abilities-aztecs.png", nation: "aztecs" }
                ]
            },
            "Blessing Cards": {
                type: "multi",
                items: [
                    { name: "Blessing Card 1", image: "img/blessing-1.png" },
                    { name: "Blessing Card 2", image: "img/blessing-2.png" },
                    { name: "Blessing Card 3", image: "img/blessing-3.png" },
                    { name: "Blessing Card 4", image: "img/blessing-4.png" },
                    { name: "Blessing Card 5", image: "img/blessing-5.png" }
                ]
            },
            // "Faith Tokens": {
            //     type: "multi",
            //     items: [
            //         { name: "1 Faith Token", image: "img/faith-1.png" },
            //         { name: "3 Faith Token", image: "img/faith-3.png" },
            //         { name: "5 Faith Token", image: "img/faith-5.png" }
            //     ]
            // },
            "Status Effect Tokens": {
                type: "multi",
                items: [
                    { name: "Blight Token", image: "img/status-blight.png" },
                    { name: "Bleeding Token", image: "img/status-bleeding.png" },
                    { name: "Ice Token", image: "img/status-ice.png" },
                    { name: "Fire Token", image: "img/status-fire.png" },
                    { name: "Shield Token", image: "img/status-shield.png" }
                ]
            }
        };

        class ComponentSlider {
            constructor(container, componentName, data) {
                this.container = container;
                this.componentName = componentName;
                this.data = data;
                this.currentIndex = 0;
                this.isTransitioning = false; // Флаг для предотвращения множественных переходов
                this.init();
            }

            init() {
                this.render();
                this.attachEvents();
            }

            render() {
                if (this.data.type === 'single') {
                    this.renderSingleComponent();
                } else {
                    this.renderSlider();
                }
            }

            renderSingleComponent() {
                this.container.innerHTML = `
                    <div class="single-component">
                        <h3 class="component-title">${this.componentName}</h3>
                        <div class="component-image">
                            <img src="${this.data.image}" alt="${this.componentName}" 
                                 onerror="this.style.display='none'; this.parentNode.innerHTML='${this.componentName}<br><small>Image not found: ${this.data.image}</small>'">
                        </div>
                    </div>
                `;
            }

            renderSlider() {
                const slides = this.data.items.map((item, index) => `
                    <div class="slide">
                        <div class="component-image">
                            <img src="${item.image}" alt="${item.name}" 
                                 onerror="this.style.display='none'; this.parentNode.innerHTML='${item.name}<br><small>Image not found</small>'">
                        </div>
                        <div class="slide-caption">${item.name}</div>
                    </div>
                `).join('');

                const indicators = this.data.items.map((item, index) => {
                    const nationClass = item.nation ? `nation-${item.nation}` : 'generic';
                    const activeClass = index === 0 ? 'active' : '';
                    return `<div class="indicator ${nationClass} ${activeClass}" data-index="${index}"></div>`;
                }).join('');

                const componentId = this.componentName.replace(/\s+/g, '').replace(/[^a-zA-Z0-9]/g, '');

                this.container.innerHTML = `
                    <h3 class="component-title">${this.componentName}</h3>
                    <div class="slider-container">
                        <div class="slider-wrapper">
                            ${slides}
                        </div>
                    </div>
                    <div class="slider-nav">
                        <button class="nav-button" data-action="prev">‹</button>
                        <div class="indicators">
                            ${indicators}
                        </div>
                        <div class="slide-counter">
                            <span class="current">1</span> / <span class="total">${this.data.items.length}</span>
                        </div>
                        <button class="nav-button" data-action="next">›</button>
                    </div>
                `;
            }

            attachEvents() {
                if (this.data.type === 'single') return;

                // Используем делегирование событий для надежности
                this.container.addEventListener('click', (e) => {
                    if (this.isTransitioning) return; // Предотвращаем множественные клики

                    if (e.target.matches('.nav-button[data-action="prev"]')) {
                        e.preventDefault();
                        this.prevSlide();
                    } else if (e.target.matches('.nav-button[data-action="next"]')) {
                        e.preventDefault();
                        this.nextSlide();
                    } else if (e.target.matches('.indicator')) {
                        e.preventDefault();
                        const index = parseInt(e.target.dataset.index);
                        if (!isNaN(index)) {
                            this.goToSlide(index);
                        }
                    }
                });

                // Добавляем обработчик окончания перехода
                const wrapper = this.container.querySelector('.slider-wrapper');
                if (wrapper) {
                    wrapper.addEventListener('transitionend', () => {
                        this.isTransitioning = false;
                    });
                }

                this.updateNavigation();
            }

            prevSlide() {
                if (this.isTransitioning || this.currentIndex <= 0) return;
                this.isTransitioning = true;
                this.currentIndex--;
                this.updateSlider();
            }

            nextSlide() {
                if (this.isTransitioning || this.currentIndex >= this.data.items.length - 1) return;
                this.isTransitioning = true;
                this.currentIndex++;
                this.updateSlider();
            }

            goToSlide(index) {
                if (this.isTransitioning || index === this.currentIndex || index < 0 || index >= this.data.items.length) return;
                this.isTransitioning = true;
                this.currentIndex = index;
                this.updateSlider();
            }

            updateSlider() {
                const wrapper = this.container.querySelector('.slider-wrapper');
                const indicators = this.container.querySelectorAll('.indicator');
                const current = this.container.querySelector('.current');

                if (wrapper) {
                    wrapper.style.transform = `translateX(-${this.currentIndex * 100}%)`;
                }
                
                indicators.forEach((indicator, index) => {
                    indicator.classList.toggle('active', index === this.currentIndex);
                });

                if (current) {
                    current.textContent = this.currentIndex + 1;
                }
                
                this.updateNavigation();
            }

            updateNavigation() {
                const prevBtn = this.container.querySelector('[data-action="prev"]');
                const nextBtn = this.container.querySelector('[data-action="next"]');

                if (prevBtn) prevBtn.disabled = this.currentIndex === 0;
                if (nextBtn) nextBtn.disabled = this.currentIndex === this.data.items.length - 1;
            }
        }

        // Initialize components
        function initComponents() {
            const grid = document.getElementById('componentsGrid');
            if (!grid) {
                console.error('Components grid not found');
                return;
            }
            
            Object.entries(componentsData).forEach(([componentName, data]) => {
                try {
                    const container = document.createElement('div');
                    container.className = 'component-container';
                    grid.appendChild(container);
                    
                    new ComponentSlider(container, componentName, data);
                } catch (error) {
                    console.error(`Error creating slider for ${componentName}:`, error);
                }
            });
        }

        // Initialize when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initComponents);
        } else {
            initComponents();
        }
    </script>
</body>
</html>